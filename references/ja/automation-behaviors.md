# 自動化動作

この文書は OmniContext の自動化に関する目標動作を定義します。`install-skill`、`init`、`sync`、`status`、`new-project`、`new-doc` にはすでに保守的な実装があります。それ以外は引き続き設計目標です。ユーザーまたはプロジェクト方針に明示がない限り、オペレーター向け既定言語は中国語です。

## `init`

目的:
- 現在のワークスペースに新しい `.omnicontext/` ディレクトリを作成する
- ワークスペースモードを保守的に推定する
- テンプレートから最小限の必須ファイルを生成する

期待される動作:
- `.omnicontext/` が既に存在する場合、既定では上書きを避ける
- Git リポジトリや主要なアプリ/サービスディレクトリなど、候補となるプロジェクトルートを走査する
- `workspace.toml` を書き込む
- `INDEX.md` を書き込む
- `shared/standards.md` を作成する
- `personal/preferences.md` を作成する
- 発見またはユーザー確認済みの各プロジェクトについてディレクトリを作成する
- 現在の言語で見出しとオペレーター向け文面を生成し、既定は中国語とする

## `sync`

目的:
- 現在のワークスペース状態に合わせて OmniContext のメタデータを更新する

期待される動作:
- `workspace.toml` を使ってワークスペースを再走査する
- 新規または削除されたプロジェクトルートを検出する
- `INDEX.md` を更新する
- 既定では既存ノートを削除せず、欠落しているプロジェクトディレクトリのみ補う
- 手書き内容をできるだけ保持する
- 再生成される要約とコンソール出力に現在の言語を反映する

## `status`

目的:
- 現在の OmniContext の健全性とカバレッジを報告する

期待される出力:
- ワークスペースモード
- 発見したプロジェクト一覧
- マッピング済みプロジェクト一覧
- 欠落している必須ファイル
- 古いまたは解決できないマッピング
- 既定で中国語となるローカライズ済みの状態表示

## `new-project`

目的:
- 新しいプロジェクト知識領域を明示的に追加する

期待される動作:
- `projects/<project-name>/` を作成する
- `overview.md`、`handoff.md`、`todo.md`、`decisions.md` を生成する
- `INDEX.md` にプロジェクトを追記する
- 必要に応じて `workspace.toml` の `[[project_mappings]]` を追加または更新する
- 現在の言語で初期プロジェクト記録を生成する

## `new-doc`

目的:
- ワークスペースが本当に必要とするときだけ追加文書を作成する

現在サポートする対象:
- 技術文書
- 設計文書
- プロダクト文書
- 運用手順書
- Wiki ページ
- 文書の骨組みは現在の言語で生成する

## 安全規則

- `.omnicontext/` に秘密情報を書かない
- 明示的な要求がない限り既存のプロジェクトノートを自動削除しない
- 破壊的な書き換えより追加型の生成を優先する
- `machine.local.toml` や `user.local.toml` などのローカル上書きファイルを保持する
